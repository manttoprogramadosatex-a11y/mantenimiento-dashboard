<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { margin: 0; background: #2f5577; font-family: 'Segoe UI', sans-serif; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
        .header { background: #274a66; color: white; padding: 10px 20px; display: flex; align-items: center; justify-content: space-between; border-bottom: 2px solid #1e3a50; height: 40px; }
        .titulo { font-size: 20px; font-weight: bold; text-transform: uppercase; }
        
        /* SECCIÓN DE UNA SOLA LÍNEA */
        .status-bar { display: flex; align-items: center; background: rgba(0,0,0,0.15); padding: 5px 10px; gap: 8px; height: 50px; justify-content: space-between; }
        .label-main { color: white; font-size: 11px; font-weight: bold; line-height: 1; min-width: 80px; }
        
        .box { background: #3c546d; border-left: 3px solid #f9b218; padding: 2px 8px; width: 90px; height: 35px; border-radius: 3px; display: flex; flex-direction: column; justify-content: center; }
        .box-red { border-left-color: #da291c; background: rgba(218,41,28,0.1); }
        .box-t { font-size: 7px; color: #a1b1c1; text-transform: uppercase; margin: 0; }
        .box-v { font-size: 16px; font-weight: bold; color: #f9b218; margin: 0; line-height: 1; }

        .stop-list { flex-grow: 1; max-width: 250px; height: 40px; border-left: 1px solid rgba(255,255,255,0.2); padding-left: 8px; overflow-y: auto; }
        .stop-item { background: rgba(218,41,28,0.2); border: 1px solid #da291c; color: white; font-size: 9px; padding: 2px 5px; margin-bottom: 2px; display: flex; justify-content: space-between; border-radius: 2px; }

        .update-info { color: #00d4ff; font-size: 9px; font-weight: bold; text-align: right; min-width: 130px; }
        .btn-refresh { background: #da291c; color: white; border: none; width: 25px; height: 25px; border-radius: 2px; cursor: pointer; font-weight: bold; }

        /* AREA DE INDICADORES */
        .gauge-area { display: flex; flex-wrap: nowrap; gap: 8px; padding: 15px; justify-content: center; background: rgba(0,0,0,0.05); flex-grow: 1; overflow-x: auto; align-items: center; }
        .gauge-card { background: white; min-width: 110px; height: 140px; border-radius: 4px; display: flex; flex-direction: column; align-items: center; padding: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
    </style>
</head>
<body>

<div class="header">
    <img src="https://manttoprogramadosatex-a11y.github.io/mantenimiento-dashboard/logo.png.jpeg" height="30">
    <div class="titulo">TABLERO MASTER SATEX</div>
    <div id="clock" style="color:white; font-size:12px;"></div>
</div>

<div class="status-bar">
    <div class="label-main">ESTATUS<br>PLANTA ▶</div>
    <div class="box"><p class="box-t">Continuas</p><p class="box-v" id="h-cont">--</p></div>
    <div class="box"><p class="box-t">Open-End</p><p class="box-v" id="h-oe">--</p></div>
    <div class="box"><p class="box-t">Coneras</p><p class="box-v" id="h-con">--</p></div>
    <div class="box box-red"><p class="box-t">Paradas</p><p class="box-v" id="total-p" style="color:#ff9999">--</p></div>
    
    <div class="stop-list" id="stop-container"></div>
    
    <div class="update-info">Actualizado:<br><span id="last-sync">...</span></div>
    <button class="btn-refresh" onclick="location.reload()">X</button>
</div>

<div class="gauge-area" id="gauge-container"></div>

<script>
    // ==========================================
    // LÍNEA 140: PEGA TU URL DE GOOGLE SCRIPT AQUÍ
    const API_URL = "https://script.google.com/macros/s/AKfycbz1_nwP2PXBM8iswDpg_8WDhDUHfAkRxPw2pCfpyusx_Lpyo4GxwOlFZ4tH2MgqPm3enA/exec";
    // ==========================================

    let myCharts = [];

    async function getData() {
        try {
            const response = await fetch(API_URL);
            const data = await response.json();
            
            // Actualizar Husos e info superior
            document.getElementById('h-cont').innerText = data.husos.cont;
            document.getElementById('h-oe').innerText = data.husos.oe;
            document.getElementById('h-con').innerText = data.husos.con;
            document.getElementById('total-p').innerText = data.paradas.length;
            document.getElementById('last-sync').innerText = data.actualizado;

            // Actualizar lista de paradas
            const list = document.getElementById('stop-container');
            list.innerHTML = data.paradas.map(p => `<div class="stop-item"><span>${p.maquina}</span><b>${p.dias} Días</b></div>`).join('');

            // Actualizar Gauges con datos reales del Excel
            data.cardas.forEach((c, i) => {
                const porc = Math.min((c.act / c.max) * 100, 100);
                myCharts[i].data.datasets[0].data = [porc, 100 - porc];
                document.getElementById(`val-${i}`).innerText = `Ac. ${c.act}`;
                document.getElementById(`max-${i}`).innerText = `Max. ${c.max}`;
                myCharts[i].update();
            });
        } catch(e) { console.error("Error cargando datos", e); }
    }

    function init() {
        const container = document.getElementById('gauge-container');
        for(let i=0; i<8; i++) {
            container.innerHTML += `
                <div class="gauge-card">
                    <b style="font-size:11px">CARDA ${i+1}</b>
                    <canvas id="chart-${i}"></canvas>
                    <p id="val-${i}" style="font-size:10px; font-weight:bold; margin:5px 0 0 0">--</p>
                    <p id="max-${i}" style="font-size:8px; color:#666; margin:0">--</p>
                </div>`;
        }
        for(let i=0; i<8; i++) {
            myCharts.push(new Chart(document.getElementById(`chart-${i}`), {
                type: 'doughnut',
                data: { datasets: [{ data: [0, 100], backgroundColor: ['#23a446', '#eee'] }] },
                options: { rotation: -110, circumference: 220, cutout: '75%', plugins: { legend: false, tooltip: false } }
            }));
        }
        getData();
        setInterval(getData, 60000); // Auto-actualizar cada minuto
    }
    window.onload = init;
</script>
</body>
</html>
