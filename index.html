<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tablero Master Mantto. Satex Textil</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
    margin:0;
    font-family: Arial, sans-serif;
    background:#2f5d86;
}

/* HEADER */
.header{
    display:flex;
    align-items:center;
    justify-content:space-between;
    padding:15px 40px;
}

.logo{
    height:50px;
}

.titulo-header{
    flex:1;
    text-align:center;
    font-size:26px;
    font-weight:bold;
    color:white;
}

.fecha{
    color:white;
    font-size:14px;
}

/* CONTENEDOR GAUGES */
.gauges-container{
    display:flex;
    justify-content:center;
    flex-wrap:wrap;
    gap:60px;
    margin-top:60px;
}

.gauge-card{
    text-align:center;
}

canvas{
    width:260px !important;
    height:260px !important;
}
</style>
</head>

<body>

<!-- HEADER -->
<div class="header">
    <img src="logo.png.jpeg" class="logo">
    <div class="titulo-header">Tablero Master Mantto. Satex Textil</div>
    <div class="fecha" id="fecha"></div>
</div>

<!-- VELOCIMETROS -->
<div class="gauges-container">
    <div class="gauge-card">
        <canvas id="g1"></canvas>
    </div>
    <div class="gauge-card">
        <canvas id="g2"></canvas>
    </div>
    <div class="gauge-card">
        <canvas id="g3"></canvas>
    </div>
</div>

<script>

/* FECHA CON MAYÚSCULA */
const opciones = { weekday:'long', year:'numeric', month:'long', day:'numeric' };
let fecha = new Date().toLocaleDateString('es-ES', opciones);
fecha = fecha.charAt(0).toUpperCase() + fecha.slice(1);
document.getElementById("fecha").innerText = fecha;


/* PLUGIN PARA AGUJA REAL */
const needlePlugin = {
    id:'needle',
    afterDraw(chart, args, options){
        const {ctx} = chart;
        const meta = chart.getDatasetMeta(0);
        const centerX = meta.data[0].x;
        const centerY = meta.data[0].y;

        const value = options.value;
        const max = options.max;

        const angle = Math.PI + (value/max)*Math.PI;

        ctx.save();
        ctx.translate(centerX, centerY);
        ctx.rotate(angle);

        // Aguja roja
        ctx.beginPath();
        ctx.moveTo(-5,0);
        ctx.lineTo(0,-110);
        ctx.lineTo(5,0);
        ctx.fillStyle="red";
        ctx.fill();

        ctx.restore();

        // Centro azul
        ctx.beginPath();
        ctx.arc(centerX, centerY, 12, 0, 2*Math.PI);
        ctx.fillStyle="#2c6cb0";
        ctx.fill();

        // Texto valor
        ctx.font="18px Arial";
        ctx.fillStyle="black";
        ctx.textAlign="center";
        ctx.fillText(value+" Toneladas", centerX, centerY+90);
    }
};


/* FUNCIÓN GAUGE */
function createGauge(id, value, max){

    new Chart(document.getElementById(id),{
        type:'doughnut',
        data:{
            datasets:[{
                data:[max*0.6, max*0.25, max*0.15],
                backgroundColor:["#2ecc71","#f1c40f","#e74c3c"],
                borderWidth:0
            }]
        },
        options:{
            rotation:180,
            circumference:180,
            cutout:"70%",
            plugins:{
                legend:{display:false},
                tooltip:{enabled:false},
                needle:{ value:value, max:max }
            }
        },
        plugins:[needlePlugin]
    });
}


/* EJEMPLO */
createGauge("g1",18,25);
createGauge("g2",12,25);
createGauge("g3",22,25);

</script>

</body>
</html>
