<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
    /* BLINDAJE ESTRUCTURAL SATEX V4 */
    body { 
        margin: 0; background-color: #2f5577; 
        font-family: 'Segoe UI', Arial, sans-serif; 
        display: flex; flex-direction: column; height: 100vh; overflow: hidden;
    }
    
    .header {
        background-color: #274a66; display: flex; align-items: center;
        padding: 0 20px; height: 55px; color: white; border-bottom: 2px solid #1e3a50;
        position: relative;
    }
    .titulo { 
        width: 100%; text-align: center; font-size: 28px; font-weight: bold; 
        color: #ffffff; text-transform: uppercase;
    }

    /* SECCIÓN ESTATUS REFORMADA */
    .seccion-estatus { 
        padding: 5px 15px; display: flex; align-items: center; gap: 10px;
        background: rgba(0,0,0,0.15); min-height: 70px;
    }

    /* TEXTO IZQUIERDO: Estatus Planta e Info Cardas con misma fuente */
    .estatus-labels {
        display: flex; flex-direction: column; align-items: center;
        color: white; min-width: 130px; line-height: 1.1;
    }
    .label-style { font-size: 16px; font-weight: bold; text-shadow: 1px 1px 2px black; }
    .flecha-v { font-size: 12px; margin-top: 2px; }

    .contenedor-bloques { display: flex; align-items: center; gap: 6px; }

    .bloque-dato {
        background: rgba(255, 255, 255, 0.1); padding: 4px 10px;
        border-radius: 4px; border-left: 5px solid #f9b218;
        min-width: 125px; height: 50px;
        display: flex; flex-direction: column; justify-content: center;
    }
    /* Bloque específico para Máquinas Paradas (Rojo) */
    .bloque-paradas { border-left-color: #da291c; background: rgba(218, 41, 28, 0.1); }
    
    .dato-etiqueta { font-size: 9px; text-transform: uppercase; color: #ddd; margin-bottom: 2px; }
    .dato-valor { font-size: 20px; font-weight: bold; color: #f9b218; }
    .valor-rojo { color: #ff6b6b !important; }

    /* LISTA DESPLEGABLE DE MÁQUINAS PARADAS */
    .contenedor-lista-paradas {
        flex-grow: 1; height: 55px; overflow-y: auto;
        background: rgba(0,0,0,0.2); border-radius: 4px; padding: 4px;
        border-left: 2px solid rgba(255,255,255,0.1);
    }
    .contenedor-lista-paradas::-webkit-scrollbar { width: 4px; }
    .contenedor-lista-paradas::-webkit-scrollbar-thumb { background: #da291c; }

    .item-parada {
        background: rgba(218, 41, 28, 0.2); border: 1px solid rgba(218, 41, 28, 0.4);
        border-radius: 3px; padding: 4px 8px; margin-bottom: 3px;
        color: white; display: flex; justify-content: space-between; font-size: 11px;
    }

    /* CONTROLES DERECHA */
    .ctrl-satex { margin-left: auto; display: flex; align-items: center; gap: 10px; }
    .btn-cardas { background: #f9b218; color: #000; border: none; padding: 8px 15px; font-weight: bold; border-radius: 4px; cursor: pointer; }
    .btn-x { background: #da291c; color: white; border: none; width: 30px; height: 30px; font-weight: bold; border-radius: 4px; cursor: pointer; }

    /* ÁREA DE GAUGES */
    .dashboard-grid {
        display: flex; overflow-x: auto; gap: 10px; padding: 20px;
        background: rgba(0,0,0,0.05); margin-top: 10px;
    }
    .gauge-card {
        background: white; min-width: 140px; height: 170px; border-radius: 8px;
        display: flex; flex-direction: column; align-items: center; padding: 10px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    }

    /* MODAL CARDAS */
    #overlayCardas { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 9999; padding: 50px; }
    .modal-box { background: #eee; height: 90%; border-radius: 10px; overflow: hidden; display: flex; flex-direction: column; }
    .modal-head { background: #274a66; color: white; padding: 15px; display: flex; justify-content: space-between; }
</style>
</head>
<body>

<div class="header">
    <div class="titulo">Tablero Master Mantto. Satex Textil</div>
</div>

<div class="seccion-estatus">
    <div class="estatus-labels">
        <span class="label-style">Estatus Planta ▶</span>
        <span class="label-style">Info Cardas</span>
        <span class="flecha-v">▼</span>
    </div>

    <div class="contenedor-bloques">
        <div class="bloque-dato"><span class="dato-etiqueta">Husos Continuas (Inact.)</span><span class="dato-valor" id="h-cont">0</span></div>
        <div class="bloque-dato"><span class="dato-etiqueta">Husos Open-End (Inact.)</span><span class="dato-valor" id="h-oe">0</span></div>
        <div class="bloque-dato"><span class="dato-etiqueta">Husos Coneras (Inact.)</span><span class="dato-valor" id="h-con">0</span></div>
        <div class="bloque-dato bloque-paradas"><span class="dato-etiqueta">Máquinas Paradas</span><span class="dato-valor valor-rojo" id="total-p">0</span></div>
    </div>

    <div class="contenedor-lista-paradas" id="lista-p">
        </div>

    <div class="ctrl-satex">
        <div id="updTime" style="color:#00d4ff; font-size:11px; font-weight:bold; text-align:right;">Actualizado:<br>--:--:--</div>
        <button class="btn-cardas" onclick="document.getElementById('overlayCardas').style.display='block'">CARDAS</button>
        <button class="btn-x" onclick="window.close()">X</button>
    </div>
</div>

<div class="dashboard-grid" id="grid-gauges"></div>

<div id="overlayCardas">
    <div class="modal-box">
        <div class="modal-head">
            <h2 style="margin:0">Reporte de Información Cardas</h2>
            <button class="btn-x" onclick="document.getElementById('overlayCardas').style.display='none'">X</button>
        </div>
        <div style="padding:20px; overflow-y:auto;" id="reporte-content">
            <p>Sincronizando con hoja de cálculo...</p>
        </div>
    </div>
</div>

<script>
    // URL DE TU SCRIPT DE GOOGLE (Debes desplegar el Apps Script con este ID de hoja)
    const SHEET_ID = "1tLFtdmbhyeE90NSqTvswbGzxC33BLUGf6b5HczUSlok";
    const APPS_SCRIPT_URL = "https://script.google.com/macros/s/TU_ID_DESPLEGADO/exec";

    function fetchData() {
        console.log("Iniciando actualización de 2 minutos...");
        // Simulación de los datos de tus hojas reales
        // En producción usaras: fetch(APPS_SCRIPT_URL).then(...)
        
        const ahora = new Date();
        document.getElementById("updTime").innerHTML = "Actualizado:<br>" + ahora.toLocaleTimeString();

        // Actualización de Husos (Valores de tu hoja)
        document.getElementById('h-cont').innerText = "16"; 
        document.getElementById('h-oe').innerText = "1";
        document.getElementById('h-con').innerText = "0";

        // Actualización de Máquinas Paradas (Lista desplegable)
        const lista = document.getElementById('lista-p');
        lista.innerHTML = `
            <div class="item-parada"><span>Regulador 10</span> <span>25/02/2025</span> <b style="color:#ff6b6b">1 Día</b></div>
            <div class="item-parada"><span>Conera 5</span> <span>26/02/2025</span> <b style="color:#ff6b6b">1 Día</b></div>
        `;
        document.getElementById('total-p').innerText = "2";
    }

    // Generar Gauges de Cardas (Diseño Fijo)
    function initGauges() {
        const grid = document.getElementById('grid-gauges');
        for(let i=1; i<=9; i++) {
            const card = document.createElement('div');
            card.className = 'gauge-card';
            card.innerHTML = `
                <b style="font-size:12px">CARDA ${i}</b>
                <canvas id="c-${i}" width="120" height="90"></canvas>
                <div style="font-size:11px; margin-top:5px"><b>Ac. 800</b></div>
                <div style="font-size:9px; color:#666">Max. 1000</div>
            `;
            grid.appendChild(card);
            
            new Chart(document.getElementById(`c-${i}`).getContext('2d'), {
                type: 'doughnut',
                data: { datasets: [{ data: [80, 20], backgroundColor: ['#23a446', '#eee'], needleValue: 80 }] },
                options: { rotation: -110, circumference: 220, cutout: '80%', plugins: { tooltip: false } }
            });
        }
    }

    window.onload = () => {
        initGauges();
        fetchData();
        // AUTO ACTUALIZACIÓN CADA 2 MINUTOS (120000 ms)
        setInterval(fetchData, 120000);
    };
</script>
</body>
</html>
