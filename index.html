<!DOCTYPE html>
<html>
<head>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
    body { margin: 0; background: #2f5577; font-family: sans-serif; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
    .header { background: #274a66; color: white; padding: 10px; text-align: center; font-weight: bold; font-size: 18px; border-bottom: 2px solid #1e3a50; }
    
    .seccion-estatus { 
        display: flex; align-items: center; padding: 5px 10px; gap: 8px; 
        background: rgba(0,0,0,0.1); height: 50px; justify-content: space-between;
    }
    .label-estatus { color: white; font-size: 11px; font-weight: bold; min-width: 80px; line-height: 1; }
    
    .bloque { background: #3c546d; border-left: 3px solid #f9b218; padding: 2px 8px; width: 95px; height: 35px; border-radius: 3px; }
    .bloque-p { border-left-color: #da291c; }
    .t { font-size: 7px; color: #a1b1c1; text-transform: uppercase; margin: 0; }
    .v { font-size: 16px; font-weight: bold; color: #f9b218; margin: 0; line-height: 1; }

    .scroll-p { flex-grow: 1; max-width: 220px; height: 40px; border-left: 1px solid #444; padding-left: 8px; overflow-y: auto; }
    .item-p { background: rgba(218,41,28,0.2); border: 1px solid #da291c; color: white; font-size: 9px; padding: 2px 5px; margin-bottom: 2px; display: flex; justify-content: space-between; }

    .info-act { color: #00d4ff; font-size: 9px; font-weight: bold; text-align: right; min-width: 120px; }
    .btn-x { background: #da291c; color: white; border: none; width: 25px; height: 25px; cursor: pointer; border-radius: 2px; }

    .area-gauges { display: flex; justify-content: center; gap: 8px; padding: 10px; flex-grow: 1; overflow-x: auto; background: rgba(0,0,0,0.05); }
    .card { background: white; width: 105px; height: 130px; border-radius: 4px; display: flex; flex-direction: column; align-items: center; padding: 5px; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
</style>
</head>
<body>

<div class="header">TABLERO MASTER SATEX</div>

<div class="seccion-estatus">
    <div class="label-estatus">ESTATUS<br>PLANTA â–¶</div>
    <div class="bloque"><p class="t">Continuas</p><p class="v" id="h1">--</p></div>
    <div class="bloque"><p class="t">Open-End</p><p class="v" id="h2">--</p></div>
    <div class="bloque"><p class="t">Coneras</p><p class="v" id="h3">--</p></div>
    <div class="bloque bloque-p"><p class="t">Paradas</p><p class="v" id="tp" style="color:#ff9999">--</p></div>
    
    <div class="scroll-p" id="lista-p"></div>
    
    <div class="info-act">Actualizado:<br><span id="act">...</span></div>
    <button class="btn-x" onclick="location.reload()">X</button>
</div>

<div class="area-gauges" id="gauges"></div>

<script>
    const URL = "https://script.google.com/macros/s/AKfycbz1_nwP2PXBM8iswDpg_8WDhDUHfAkRxPw2pCfpyusx_Lpyo4GxwOlFZ4tH2MgqPm3enA/exec"; 
    let charts = [];

    async function update() {
        try {
            const res = await fetch(URL);
            const d = await res.json();
            
            document.getElementById('h1').innerText = d.husos.continuas;
            document.getElementById('h2').innerText = d.husos.oe;
            document.getElementById('h3').innerText = d.husos.coneras;
            document.getElementById('tp').innerText = d.paradas.length;
            document.getElementById('act').innerText = d.actualizado;

            const lista = document.getElementById('lista-p');
            lista.innerHTML = d.paradas.map(p => `<div class="item-p"><span>${p.nombre}</span><b>${p.dias}D</b></div>`).join('');

            d.cardas.forEach((c, i) => {
                const porc = Math.min((c.act / c.max) * 100, 100);
                charts[i].data.datasets[0].data = [porc, 100 - porc];
                document.getElementById(`val-${i}`).innerText = `Ac. ${c.act}`;
                charts[i].update();
            });
        } catch(e) { console.error(e); }
    }

    function init() {
        const cont = document.getElementById('gauges');
        for(let i=0; i<8; i++) {
            cont.innerHTML += `<div class="card"><b style="font-size:10px">CARDA ${i+1}</b><canvas id="c${i}"></canvas><p id="val-${i}" style="font-size:9px; font-weight:bold; margin:5px 0 0 0">--</p><p style="font-size:7px; color:#666; margin:0">Max. 1000</p></div>`;
        }
        for(let i=0; i<8; i++) {
            charts.push(new Chart(document.getElementById(`c${i}`), {
                type: 'doughnut',
                data: { datasets: [{ data: [0, 100], backgroundColor: ['#23a446', '#eee'] }] },
                options: { rotation: -110, circumference: 220, cutout: '75%', plugins: { legend: false } }
            }));
        }
        update();
        setInterval(update, 60000);
    }
    window.onload = init;
</script>
</body>
</html>
